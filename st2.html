<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Wireframe Galaxy — Course Plot & ETA</title>
<style>
  html,body{margin:0;height:100%;background:#000;color:#9f9;
  font-family:system-ui,monospace;overflow:hidden}
  #hud{position:fixed;left:12px;top:10px;user-select:none;
  pointer-events:none;font-size:13px;line-height:1.35;
  background:rgba(0,0,0,.35);padding:8px 10px;
  border:1px solid #073;border-radius:8px;text-shadow:0 0 6px #0f0}
  #titlebar{position:fixed;top:0;width:100%;text-align:center;
  padding:8px 0 6px;font-weight:700;letter-spacing:.06em;
  user-select:none;pointer-events:none;text-shadow:0 0 8px #0f0,0 0 14px #090}
  canvas{display:block;width:100%;height:100%}
</style>
</head>
<body>
<div id="titlebar">GALAXY — ☣ Cleoms, ☉ Bases, ^A^ Ship — Double-click Cleom to plot course</div>
<canvas id="c"></canvas>
<div id="hud"></div>

<script>
(()=>{
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d",{alpha:false});
const hud=document.getElementById("hud");

function resize(){
  const dpr=Math.max(1,Math.min(2.5,window.devicePixelRatio||1));
  canvas.width=innerWidth*dpr;
  canvas.height=innerHeight*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
addEventListener("resize",resize);resize();

// --- galaxy stars ---
const STAR_COUNT=2000,stars=[];
for(let i=0;i<STAR_COUNT;i++){
  const u=Math.random(),r=Math.pow(u,.55),
  arm=i%2,base=(arm?0:Math.PI)+r*6,
  t=base+(Math.random()-.5)*.35,
  x=r*Math.cos(t),y=r*Math.sin(t),
  z=(Math.random()-.5)*.06*(1-r*.7),
  b=.6+.4*(1-r);
  stars.push({x,y,z,b});
}

// --- Cleoms ---
const CLEOM_COUNT=40,cleoms=[];
for(let i=0;i<CLEOM_COUNT;i++){
  const r=Math.random()*.9+.1,theta=Math.random()*Math.PI*2;
  cleoms.push({x:r*Math.cos(theta),y:r*Math.sin(theta),z:(Math.random()-.5)*.05});
}

// --- Starbases ---
const BASE_COUNT=3,bases=[];
for(let i=0;i<BASE_COUNT;i++){
  const r=Math.random()*.8+.15,t=Math.random()*Math.PI*2;
  bases.push({x:r*Math.cos(t),y:r*Math.sin(t),z:(Math.random()-.5)*.02});
}

// --- player ship ---
const ship={x:0,y:0,z:0,fuel:100};

// --- camera ---
let yaw=0,pitch=0,zoom=1,targetZoom=1,panX=0,panY=0,targetPanX=0,targetPanY=0;
const KEY={},clamp=(v,lo,hi)=>Math.max(lo,Math.min(hi,v));
addEventListener("keydown",e=>{KEY[e.key]=true});
addEventListener("keyup",e=>{KEY[e.key]=false});

// --- zoom centered ---
canvas.addEventListener("wheel",e=>{
  e.preventDefault();
  const rect=canvas.getBoundingClientRect(),cx=rect.width/2,cy=rect.height/2;
  const mx=e.clientX-rect.left-cx-panX,my=e.clientY-rect.top-cy-panY;
  const factor=Math.exp(-e.deltaY*.0015);
  const newZoom=clamp(targetZoom*factor,.2,8);
  const k=newZoom/targetZoom;
  targetPanX-=mx*(k-1);targetPanY-=my*(k-1);targetZoom=newZoom;
},{passive:false});

// --- click selection / double-click course plotting ---
let selected=null,course=null,lastClick=0;
canvas.addEventListener("click",e=>{
  const now=performance.now(),rect=canvas.getBoundingClientRect();
  const cx=rect.width/2,cy=rect.height/2,scale=Math.min(cx,cy)*.9*zoom;
  const mx=e.clientX-rect.left-cx-panX,my=e.clientY-rect.top-cy-panY;
  const cyaw=Math.cos(yaw),syaw=Math.sin(yaw),cp=Math.cos(pitch),sp=Math.sin(pitch);
  let hit=null,minDist=20;
  for(const c of cleoms){
    const rx=c.x*cyaw-c.z*syaw,rz=c.x*syaw+c.z*cyaw,ry=c.y*cp-rz*sp;
    const sx=rx*scale,sy=ry*scale,dx=mx-sx,dy=my-sy;
    const dist=Math.sqrt(dx*dx+dy*dy);
    if(dist<minDist){hit=c;minDist=dist;}
  }
  if(now-lastClick<300 && selected===hit && hit){course={target:hit,time:now};}
  else selected=hit;
  lastClick=now;
});

function rotatePoint(p,yaw,pitch){
  const cy=Math.cos(yaw),sy=Math.sin(yaw),cp=Math.cos(pitch),sp=Math.sin(pitch);
  const x1=p.x*cy-p.z*sy,z1=p.x*sy+p.z*cy;
  const y1=p.y*cp-z1*sp,z2=p.y*sp+z1*cp;
  return{x:x1,y:y1,z:z2};
}
function distance3D(a,b){const dx=a.x-b.x,dy=a.y-b.y,dz=a.z-b.z;
  return Math.sqrt(dx*dx+dy*dy+dz*dz);}

// --- drawing ---
function drawStars(scale,cx,cy){
  ctx.save();ctx.translate(cx+panX,cy+panY);
  for(const s of stars){
    const r=rotatePoint(s,yaw,pitch);
    const sx=r.x*scale,sy=r.y*scale,size=s.b*2*zoom;
    ctx.globalAlpha=.35+s.b*.65;ctx.fillStyle="#9f9";
    ctx.fillRect(sx-size/2,sy-size/2,size,size);
  }ctx.globalAlpha=1;ctx.restore();
}
function drawBases(scale,cx,cy){
  ctx.save();ctx.translate(cx+panX,cy+panY);
  for(const b of bases){
    const r=rotatePoint(b,yaw,pitch),sx=r.x*scale,sy=r.y*scale,size=12*Math.sqrt(zoom);
    ctx.font=`${size}px monospace`;ctx.textAlign="center";ctx.textBaseline="middle";
    ctx.fillStyle="#0ff";ctx.shadowColor="#0ff";ctx.shadowBlur=10;ctx.fillText("☉",sx,sy);
  }ctx.shadowBlur=0;ctx.restore();
}
function drawCleoms(scale,cx,cy){
  if(zoom<2.0)return;ctx.save();ctx.translate(cx+panX,cy+panY);
  for(const c of cleoms){
    const r=rotatePoint(c,yaw,pitch),sx=r.x*scale,sy=r.y*scale,size=12*Math.sqrt(zoom);
    ctx.font=`${size}px sans-serif`;ctx.textAlign="center";ctx.textBaseline="middle";
    ctx.fillStyle="#0f0";ctx.shadowColor="#0f0";ctx.shadowBlur=10;ctx.globalAlpha=.9;
    ctx.fillText("☣",sx,sy);
    if(selected===c){ctx.shadowBlur=0;ctx.globalAlpha=1;ctx.strokeStyle="#0f0";
      const box=size*.9;ctx.strokeRect(sx-box,sy-box,box*2,box*2);}
  }
  ctx.shadowBlur=0;ctx.restore();
}
function drawShip(scale,cx,cy){
  ctx.save();ctx.translate(cx+panX,cy+panY);
  const r=rotatePoint(ship,yaw,pitch),sx=r.x*scale,sy=r.y*scale;
  const size=16*Math.sqrt(zoom);
  ctx.font=`${size}px monospace`;ctx.textAlign="center";ctx.textBaseline="middle";
  ctx.fillStyle="#0f0";ctx.shadowColor="#0f0";ctx.shadowBlur=8;ctx.fillText("^A^",sx,sy);
  ctx.shadowBlur=0;ctx.restore();
}
function drawCourse(scale,cx,cy){
  if(!course)return;
  ctx.save();ctx.translate(cx+panX,cy+panY);
  const sR=rotatePoint(ship,yaw,pitch),tR=rotatePoint(course.target,yaw,pitch);
  const sx=sR.x*scale,sy=sR.y*scale,tx=tR.x*scale,ty=tR.y*scale;
  ctx.strokeStyle="#0f0";ctx.lineWidth=1;ctx.beginPath();
  ctx.moveTo(sx,sy);ctx.lineTo(tx,ty);ctx.stroke();
  ctx.restore();
}

// --- controls ---
function update(dt){
  const rs=1.2,ts=0.9;
  if(KEY.ArrowLeft)yaw-=rs*dt;
  if(KEY.ArrowRight)yaw+=rs*dt;
  if(KEY.z||KEY.Z){
    if(KEY.ArrowUp)targetZoom=clamp(targetZoom*1.03,.2,8);
    if(KEY.ArrowDown)targetZoom=clamp(targetZoom/1.03,.2,8);
  }else{
    if(KEY.ArrowUp)pitch-=ts*dt;
    if(KEY.ArrowDown)pitch+=ts*dt;
  }
  if(KEY["+"]||KEY["="])targetZoom=clamp(targetZoom*1.02,.2,8);
  if(KEY["-"])targetZoom=clamp(targetZoom/1.02,.2,8);
  zoom+=(targetZoom-zoom)*(1-Math.pow(.001,dt));
  panX+=(targetPanX-panX)*(1-Math.pow(.0015,dt));
  panY+=(targetPanY-panY)*(1-Math.pow(.0015,dt));
}

// --- main loop ---
let last=performance.now();
function loop(now){
  const dt=Math.min(.05,(now-last)/1000);last=now;update(dt);
  ctx.fillStyle="#000";ctx.fillRect(0,0,canvas.width,canvas.height);
  const cx=canvas.width/(2*(window.devicePixelRatio||1));
  const cy=canvas.height/(2*(window.devicePixelRatio||1));
  const scale=Math.min(cx,cy)*.9*zoom;

  drawStars(scale,cx,cy);
  drawBases(scale,cx,cy);
  drawCleoms(scale,cx,cy);
  drawCourse(scale,cx,cy);
  drawShip(scale,cx,cy);

  let info="";
  if(selected){
    const d=distance3D(ship,selected);
    info+=`<br>Target Distance: ${d.toFixed(3)} units`;
  }
  if(course){
    const d=distance3D(ship,course.target);
    const speed=0.25; // same as ship nominal speed
    const eta=d/speed;
    info+=`<br><span style="color:#0f0">Plotted Course</span> — ETA: ${eta.toFixed(1)} sec`;
  }
  hud.innerHTML=`yaw:${yaw.toFixed(2)}<br>pitch:${pitch.toFixed(2)}<br>zoom:${zoom.toFixed(2)}${info}`;
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
})();
</script>
</body>
</html>
